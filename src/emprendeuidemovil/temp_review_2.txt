101:    };
102:
103:    if (!isDraft && _nameController.text.isEmpty) {
104:      ScaffoldMessenger.of(context).showSnackBar(
105:          const SnackBar(content: Text("Ingresa el nombre del emprendimiento")));
106:      return;
107:    }
108:
109:    Navigator.pop(context, {
110:      'action': widget.entrepreneurship != null ? 'update' : 'create',
111:      'data': data,
112:    });
113:  }
114:
115:  @override
116:  Widget build(BuildContext context) {
117:    return WillPopScope(
118:      onWillPop: () async {
119:        _saveAndExit(isDraft: true);
120:        return false;
121:      },
122:      child: Scaffold(
123:      backgroundColor: Theme.of(context).brightness == Brightness.dark ? const Color(0xFF121212) : Colors.white,
124:      body: Column(
125:        children: [
126:          _buildTopBar(context),
127:          Expanded(
128:            child: SingleChildScrollView(
129:              padding: const EdgeInsets.all(20),
130:              child: Column(
131:                crossAxisAlignment: CrossAxisAlignment.start,
132:                children: [
133:                   // Information Header
134:                   Text(
135:                     "InformaciÃ³n Basica",
136:                     style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold, color: Theme.of(context).brightness == Brightness.dark ? Colors.white : Colors.black),
137:                   ),
138:                   const SizedBox(height: 16),
139:
140:                   // Name Input
141:                   const Text("Nombre del emprendimiento", style: TextStyle(fontWeight: FontWeight.bold)),
142:                   const SizedBox(height: 8),
143:                   TextField(
144:                     controller: _nameController,
145:                     style: TextStyle(color: Theme.of(context).brightness == Brightness.dark ? Colors.white : Colors.black),
146:                     decoration: InputDecoration(
147:                       filled: true,
148:                       fillColor: Theme.of(context).brightness == Brightness.dark ? const Color(0xFF1E1E1E) : Colors.white,
149:                       hintText: 'Ej. Delicias Caseras',
150:                       hintStyle: TextStyle(color: Colors.grey.shade400),
151:                       border: OutlineInputBorder(
152:                         borderRadius: BorderRadius.circular(20),
153:                         borderSide: BorderSide(color: Colors.grey.shade300),
154:                       ),
155:                       enabledBorder: OutlineInputBorder(
156:                         borderRadius: BorderRadius.circular(20),
157:                         borderSide: BorderSide(color: Colors.grey.shade300),
158:                       ),
159:                     ),
160:                   ),
161:                   const SizedBox(height: 20),
162:
163:                   // Categories
164:                   const Text("Categoria", style: TextStyle(fontWeight: FontWeight.bold)),
165:                   const SizedBox(height: 12),
166:                    // First row - 5 categories
167:                    Row(
168:                      mainAxisAlignment: MainAxisAlignment.spaceBetween,
169:                      children: [
170:                        _buildCategoryItem("Bienestar", Icons.spa),
171:                        _buildCategoryItem("Eventos", Icons.event),
172:                        _buildCategoryItem("Mascotas", Icons.pets),
173:                        _buildCategoryItem("Tecnologia", Icons.computer),
174:                        _buildCategoryItem("Gastronomia", Icons.restaurant),
175:                      ],
176:                    ),
177:                    const SizedBox(height: 16),
178:                    // Second row - 4 categories
179:                    Row(
180:                      mainAxisAlignment: MainAxisAlignment.spaceEvenly,
181:                      children: [
182:                        _buildCategoryItem("Moda", Icons.checkroom),
183:                        _buildCategoryItem("Diseño", Icons.brush),
184:                        _buildCategoryItem("Educación", Icons.school),
185:                        _buildCategoryItem("Movilidad", Icons.directions_car),
186:                      ],
187:                    ),
188:                   const SizedBox(height: 20),
189:
190:                   // Description
191:                   const Text("DescripciÃ³n", style: TextStyle(fontWeight: FontWeight.bold)),
192:                   const SizedBox(height: 8),
193:                   TextField(
194:                     controller: _descriptionController,
195:                     maxLines: 4,
196:                     decoration: InputDecoration(
197:                       hintText: 'Describe tu emprendimiento',
198:                       hintStyle: TextStyle(color: Colors.grey.shade400),
199:                       border: OutlineInputBorder(
200:                         borderRadius: BorderRadius.circular(20),
201:                         borderSide: BorderSide(color: Colors.grey.shade300),
202:                       ),
203:                       enabledBorder: OutlineInputBorder(
204:                         borderRadius: BorderRadius.circular(20),
205:                         borderSide: BorderSide(color: Colors.grey.shade300),
206:                       ),
207:                     ),
208:                   ),
209:                   const SizedBox(height: 20),
210:
211:                   // Location (Placeholder)
212:                   const Text("UbicaciÃ³n", style: TextStyle(fontWeight: FontWeight.bold)),
213:                   const SizedBox(height: 8),
214:                   Container(
215:                     width: double.infinity,
216:                     padding: const EdgeInsets.all(16),
217:                     decoration: BoxDecoration(
218:                       color: Theme.of(context).brightness == Brightness.dark ? const Color(0xFF1E1E1E) : Colors.grey.shade100,
219:                       borderRadius: BorderRadius.circular(15),
220:                       border: Border.all(color: Colors.grey.shade300),
221:                     ),
222:                     child: Row(
223:                       children: [
224:                         const Icon(Icons.location_on, color: Color(0xFF83002A), size: 30),
225:                         const SizedBox(width: 12),
226:                         Expanded(
227:                           child: Text(
228:                             "Sede Loja Universidad Internacional del Ecuador",
229:                             style: TextStyle(
230:                                 fontSize: 14,
231:                                 fontWeight: FontWeight.bold,
232:                                 color: Theme.of(context).brightness == Brightness.dark ? Colors.white : Colors.black87),
233:                           ),
234:                         ),
235:                       ],
236:                     ),
237:                   ),
238:                   const SizedBox(height: 20),
239:
240:                   // Schedule
241:                   const Text("Horario de AtenciÃ³n", style: TextStyle(fontWeight: FontWeight.bold)),
242:                   const SizedBox(height: 8),
243:                   _buildSchedulePicker(),
244:                   const SizedBox(height: 20),
245:
246:                   // Services Header
247:                   Row(
248:                     mainAxisAlignment: MainAxisAlignment.spaceBetween,
249:                     children: [
250:                       const Text("Servicios / Productos", style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold)),
251:                       Container(
252:                         padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 4),
253:                         decoration: BoxDecoration(
254:                           color: const Color(0xFFFFA600),
255:                           borderRadius: BorderRadius.circular(15),
256:                         ),
257:                         child: Text(
258:                           "${_services.length} Servicios",
259:                           style: const TextStyle(color: Colors.white, fontWeight: FontWeight.bold, fontSize: 12),
260:                         ),
261:                       )
262:                     ],
263:                   ),
264:                   const SizedBox(height: 16),
265:
266:                   // Services List
267:                   ..._services.asMap().entries.map((entry) {
268:                      return _buildServiceCard(entry.key + 1, entry.value);
269:                   }).toList(),
270:
271:                   const SizedBox(height: 20),
272:
273:                   // Add New Service Form
274:                   _buildAddServiceForm(),
275:
276:                   const SizedBox(height: 40),
277:
278:                   // Action Buttons
279:                   Row(
280:                     children: [
281:                       Expanded(
282:                          child: OutlinedButton(
283:                            onPressed: () => _saveAndExit(isDraft: true),
284:                           style: OutlinedButton.styleFrom(
285:                             padding: const EdgeInsets.symmetric(vertical: 16),
286:                             side: const BorderSide(color: Color(0xFF83002A)),
287:                             shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(30)),
288:                           ),
289:                           child: const Text("Guardar Borrador", style: TextStyle(color: Color(0xFF83002A), fontWeight: FontWeight.bold)),
290:                         ),
291:                       ),
292:                       const SizedBox(width: 12),
293:                       Expanded(
294:                          child: ElevatedButton(
295:                            onPressed: () => _saveAndExit(isDraft: false),
296:                           style: ElevatedButton.styleFrom(
297:                             padding: const EdgeInsets.symmetric(vertical: 16),
298:                             backgroundColor: const Color(0xFF83002A),
299:                             shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(30)),
300:                           ),
301:                           child: Text(
302:                             widget.entrepreneurship != null ? "Guardar Cambios" : "Crear Emprendimiento", 
303:                             style: const TextStyle(color: Colors.white, fontWeight: FontWeight.bold, fontSize: 13)
304:                           ),
305:                         ),
306:                       ),
307:                     ],
308:                   ),
309:                   if (widget.entrepreneurship != null) ...[
310:                      const SizedBox(height: 12),
311:                      SizedBox(
312:                        width: double.infinity,
313:                        child: TextButton(
314:                          onPressed: () {
315:                             // Confirm delete
316:                             showDialog(
317:                               context: context, 
318:                               builder: (context) => AlertDialog(
319:                                 title: const Text("Eliminar Emprendimiento"),
320:                                 content: const Text("Â¿EstÃ¡s seguro de que quieres eliminar este emprendimiento?"),
321:                                 actions: [
322:                                   TextButton(
323:                                     onPressed: () => Navigator.pop(context), 
324:                                     child: const Text("Cancelar")
325:                                   ),
326:                                   TextButton(
327:                                     onPressed: () {
328:                                       Navigator.pop(context); // Close dialog
329:                                       Navigator.pop(context, {'action': 'delete'}); // Return delete action
330:                                     }, 
331:                                     child: const Text("Eliminar", style: TextStyle(color: Colors.red))
332:                                   ),
333:                                 ],
334:                               )
335:                             );
336:                          },
337:                          child: const Text("Eliminar Emprendimiento", style: TextStyle(color: Colors.red)),
338:                        ),
339:                      )
340:                   ],
341:                   const SizedBox(height: 20),
342:                ],
343:              ),
344:            ),
345:          ),
346:        ],
347:      ),
348:      ),
349:    );
350:  }
351:
352:  Widget _buildTopBar(BuildContext context) {
353:    return Container(
354:      width: double.infinity,
355:      padding: const EdgeInsets.only(top: 50, bottom: 20, left: 16, right: 16),
356:      decoration: const BoxDecoration(
357:        color: Color(0xFF83002A),
358:        borderRadius: BorderRadius.only(
359:          bottomLeft: Radius.circular(20),
360:          bottomRight: Radius.circular(20),
361:        ),
362:      ),
363:      child: Row(
364:        children: [
365:          IconButton(
366:            icon: const Icon(Icons.arrow_back, color: Colors.white, size: 30),
367:            onPressed: () => _saveAndExit(isDraft: true),
368:          ),
369:          const SizedBox(width: 8),
370:          const Expanded(
371:            child: Text(
372:              'Crear Emprendimiento',
373:              style: TextStyle(
374:                color: Colors.white,
375:                fontSize: 20,
376:                fontWeight: FontWeight.bold,
377:              ),
378:            ),
379:          ),
380:        ],
381:      ),
382:    );
383:  }
384:
385:  Widget _buildCategoryItem(String name, IconData icon) {
386:    bool isSelected = _selectedCategory == name;
387:    final isDark = Theme.of(context).brightness == Brightness.dark;
388:    return GestureDetector(
389:      onTap: () {
390:        setState(() {
391:          _selectedCategory = name;
392:        });
393:      },
394:      child: Column(
395:        children: [
396:          Container(
397:            width: 60,
398:            height: 60,
399:            decoration: BoxDecoration(
400:              shape: BoxShape.circle,
